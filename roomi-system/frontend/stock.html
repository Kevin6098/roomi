<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ROOMI — Stock</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header class="app-header">
    <div class="header-inner">
      <a href="index.html" class="logo-link">
        <img src="images/logo.png" alt="ROOMI" class="logo-img">
        <span class="logo-text">ROOMI</span>
      </a>
      <div class="header-right">
        <button type="button" class="nav-toggle" aria-label="Menu" aria-expanded="false"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/></svg></button>
        <nav class="nav-links">
          <a href="index.html" data-i18n="nav_home">Home</a>
          <a href="stock.html" data-i18n="nav_stock">Stock</a>
          <a href="items.html" data-i18n="nav_items">Items</a>
          <a href="customers.html" data-i18n="nav_customers">Customers</a>
        </nav>
        <span class="lang-switcher">
          <a href="#" class="lang-switch" data-lang="en">EN</a> <span class="lang-sep">|</span> <a href="#" class="lang-switch" data-lang="ja">日本語</a>
        </span>
      </div>
    </div>
  </header>
  <main id="stock-main" data-mode="buy">
    <h2 class="page-title" data-i18n="stock_title">Stock</h2>
    <div id="alert" class="alert hidden"></div>

    <div class="stock-mode-cards" role="tablist" aria-label="Stock action">
      <button type="button" class="stock-mode-card active" role="tab" aria-selected="true" data-mode="buy" data-i18n="card_buy">Buy</button>
      <button type="button" class="stock-mode-card" role="tab" aria-selected="false" data-mode="output" data-i18n="card_rent_sell">Rent / Sell</button>
    </div>

    <section class="stock-section" id="section-input">
      <h3 class="stock-section-title" data-i18n="section_input">Input (Buy)</h3>
      <p class="page-intro" id="buy-intro">Record items you obtain from Rednote, Facebook, friends, etc. New items are set to <strong>in_stock</strong>.</p>
      <div class="card">
        <h4 data-i18n="new_acquisition">New acquisition</h4>
        <form id="acquire-form">
          <div class="form-group">
            <label data-i18n="title">Title *</label>
            <input type="text" id="title" required data-i18n-placeholder="placeholder_title" placeholder="e.g. Small fridge">
          </div>
          <div class="form-row form-row-2">
            <div class="form-group">
              <label data-i18n="main_category">Main Category *</label>
              <select id="main-category" required>
                <option value="" data-i18n="select_placeholder">— Select —</option>
              </select>
            </div>
            <div class="form-group">
              <label data-i18n="sub_category">Sub Category *</label>
              <select id="sub-category" required>
                <option value="" data-i18n="select_sub_first">— Select main first —</option>
              </select>
            </div>
          </div>
          <div class="form-row form-row-2">
            <div class="form-group">
              <label data-i18n="acquisition_date">Acquisition date *</label>
              <input type="date" id="acquisition_date" required>
            </div>
          </div>
          <div class="form-row form-row-2">
            <div class="form-group">
              <label data-i18n="source_platform">Source platform</label>
              <select id="source_platform">
                <option value="" data-i18n="select_placeholder">— Select —</option>
                <option value="rednote" data-i18n="platform_rednote">Rednote</option>
                <option value="facebook" data-i18n="platform_facebook">Facebook</option>
                <option value="friends" data-i18n="platform_friends">Friends</option>
                <option value="mercari" data-i18n="platform_mercari">Mercari</option>
                <option value="jimoty" data-i18n="platform_jimoty">Jimoty</option>
                <option value="yahoo_auctions" data-i18n="platform_yahoo_auctions">Yahoo Auctions</option>
                <option value="other" data-i18n="platform_other">Other</option>
              </select>
              <input type="text" id="source_platform_other" class="hidden" data-i18n-placeholder="placeholder_platform_other" placeholder="Type platform name…" style="margin-top:0.35rem;">
            </div>
            <div class="form-group">
              <label data-i18n="acquisition_type">Acquisition type</label>
              <select id="acquisition_type">
                <option value="free" data-i18n="free">free</option>
                <option value="cheap" data-i18n="cheap">cheap</option>
                <option value="bought" data-i18n="bought">bought</option>
              </select>
            </div>
          </div>
          <div class="form-row form-row-2">
            <div class="form-group">
              <label data-i18n="acquisition_cost">Acquisition cost (¥)</label>
              <input type="number" id="acquisition_cost" min="0" step="0.01" value="0">
            </div>
            <div class="form-group">
              <label data-i18n="original_price">Original price (¥) — for damage</label>
              <input type="number" id="original_price" min="0" step="0.01" data-i18n-placeholder="placeholder_optional" placeholder="Optional">
            </div>
          </div>
          <div class="form-row form-row-2">
            <div class="form-group">
              <label data-i18n="condition">Condition</label>
              <select id="condition">
                <option value="new" data-i18n="cond_new">new</option>
                <option value="good" selected data-i18n="new_good">good</option>
                <option value="fair" data-i18n="new_fair">fair</option>
                <option value="poor" data-i18n="new_poor">poor</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <a href="#" id="toggle-exact-location" class="link-secondary" data-i18n="add_exact_location">+ Add exact location (optional)</a>
            <div id="exact-location-wrap" class="hidden" style="margin-top:0.35rem;">
              <label data-i18n="exact_location">Exact location</label>
              <input type="text" id="exact_location" data-i18n-placeholder="placeholder_exact_location" placeholder="e.g. address or precise spot">
            </div>
          </div>
          <div class="form-group">
            <label data-i18n="notes">Notes</label>
            <textarea id="notes" rows="2" data-i18n-placeholder="placeholder_optional" placeholder="Optional"></textarea>
          </div>
          <button type="submit" class="btn btn-primary" data-i18n="save_acquisition">Save acquisition</button>
        </form>
      </div>
      <div class="card">
        <h4 data-i18n="recently_acquired">Recently acquired (last 10)</h4>
        <div id="recently-acquired" class="loading" data-i18n="loading">Loading…</div>
      </div>
    </section>

    <section class="stock-section" id="section-output">
      <h3 class="stock-section-title" data-i18n="section_output">Output (Sell/Rent)</h3>
      <p class="page-intro">Pick from inventory (in stock, listed, or reserved) to sell or rent.</p>
      <div class="tabs">
        <button type="button" class="tab-btn active" data-tab="sell" data-i18n="tab_sell">Sell</button>
        <button type="button" class="tab-btn" data-tab="rent" data-i18n="tab_rent">Rent</button>
      </div>
      <div id="pane-sell" class="tab-pane active">
        <div class="card">
          <h4 data-i18n="create_sale">Create sale</h4>
          <form id="sell-form">
            <div class="form-group">
              <label data-i18n="search_pick_item">Search & pick item *</label>
              <input type="text" id="sell-search" data-i18n-placeholder="search_by_title" placeholder="Search by title…">
              <select id="sell-item_id" required style="margin-top:0.35rem;">
                <option value="" data-i18n="select_item_placeholder">— Select item —</option>
              </select>
            </div>
            <div class="form-group">
              <label data-i18n="customer_required">Customer *</label>
              <select id="sell-customer_id">
                <option value="" data-i18n="select_customer_placeholder">— Select existing or add new below —</option>
              </select>
            </div>
            <div class="form-group" id="sell-quick-customer" style="display:none;">
              <label data-i18n="quick_add_customer">Quick add customer</label>
              <select id="sell-new-platform" style="margin-bottom:0.35rem;">
                <option value="" data-i18n="platform_dropdown">— Platform —</option>
                <option value="line">Line</option>
                <option value="facebook" data-i18n="platform_facebook">Facebook</option>
                <option value="rednote" data-i18n="platform_rednote">Rednote</option>
                <option value="mercari" data-i18n="platform_mercari">Mercari</option>
                <option value="jimoty" data-i18n="platform_jimoty">Jimoty</option>
                <option value="yahoo_auctions" data-i18n="platform_yahoo_auctions">Yahoo Auctions</option>
                <option value="other" data-i18n="platform_other">Other</option>
              </select>
              <input type="text" id="sell-new-platform-other" class="hidden" data-i18n-placeholder="platform_name_placeholder" placeholder="Platform name…" style="margin-bottom:0.35rem;">
              <input type="text" id="sell-new-name" data-i18n-placeholder="name_required" placeholder="Name *" style="margin-bottom:0.35rem;">
              <input type="text" id="sell-new-app_id" data-i18n-placeholder="app_id_placeholder" placeholder="ID on platform (app ID)">
            </div>
            <div class="form-group">
              <label><input type="checkbox" id="sell-use-new-customer"> <span data-i18n="use_new_customer">Use new customer (above)</span></label>
            </div>
            <div class="form-row form-row-2">
              <div class="form-group">
                <label data-i18n="sale_price_required">Sale price (¥) *</label>
                <input type="number" id="sell-sale_price" min="0" step="0.01" required>
              </div>
              <div class="form-group">
                <label data-i18n="sale_date_required">Sale date *</label>
                <input type="date" id="sell-sale_date" required>
              </div>
            </div>
            <div class="form-group">
              <a href="#" id="sell-toggle-exact-location" class="link-secondary" data-i18n="add_exact_location_where">+ Add exact location — where item will go (optional)</a>
              <div id="sell-exact-location-wrap" class="hidden" style="margin-top:0.35rem;">
                <label data-i18n="exact_location">Exact location</label>
                <input type="text" id="sell-exact_location" data-i18n-placeholder="placeholder_delivery" placeholder="e.g. address or delivery spot">
              </div>
            </div>
            <div class="form-group">
              <label data-i18n="notes">Notes</label>
              <textarea id="sell-notes" rows="2"></textarea>
            </div>
            <button type="submit" class="btn btn-primary" data-i18n="confirm_sell_btn">Confirm & sell</button>
          </form>
        </div>
      </div>
      <div id="pane-rent" class="tab-pane">
        <div class="card">
          <h4 data-i18n="create_rental">Create rental</h4>
          <form id="rent-form">
            <div class="form-group">
              <label data-i18n="search_pick_item">Search & pick item *</label>
              <input type="text" id="rent-search" data-i18n-placeholder="search_by_title" placeholder="Search by title…">
              <select id="rent-item_id" required style="margin-top:0.35rem;">
                <option value="" data-i18n="select_item_placeholder">— Select item —</option>
              </select>
            </div>
            <div class="form-group">
              <label data-i18n="customer_required">Customer *</label>
              <select id="rent-customer_id">
                <option value="" data-i18n="select_customer_placeholder">— Select existing or add new below —</option>
              </select>
            </div>
            <div class="form-group" id="rent-quick-customer" style="display:none;">
              <label data-i18n="quick_add_customer">Quick add customer</label>
              <select id="rent-new-platform" style="margin-bottom:0.35rem;">
                <option value="" data-i18n="platform_dropdown">— Platform —</option>
                <option value="line">Line</option>
                <option value="facebook" data-i18n="platform_facebook">Facebook</option>
                <option value="rednote" data-i18n="platform_rednote">Rednote</option>
                <option value="mercari" data-i18n="platform_mercari">Mercari</option>
                <option value="jimoty" data-i18n="platform_jimoty">Jimoty</option>
                <option value="yahoo_auctions" data-i18n="platform_yahoo_auctions">Yahoo Auctions</option>
                <option value="other" data-i18n="platform_other">Other</option>
              </select>
              <input type="text" id="rent-new-platform-other" class="hidden" data-i18n-placeholder="platform_name_placeholder" placeholder="Platform name…" style="margin-bottom:0.35rem;">
              <input type="text" id="rent-new-name" data-i18n-placeholder="name_required" placeholder="Name *" style="margin-bottom:0.35rem;">
              <input type="text" id="rent-new-app_id" data-i18n-placeholder="app_id_placeholder" placeholder="ID on platform (app ID)">
            </div>
            <div class="form-group">
              <label><input type="checkbox" id="rent-use-new-customer"> <span data-i18n="use_new_customer">Use new customer (above)</span></label>
            </div>
            <div class="form-row form-row-2">
              <div class="form-group">
                <label data-i18n="rent_monthly_required">Rent monthly (¥) *</label>
                <input type="number" id="rent-rent_price_monthly" min="0" step="0.01" required>
              </div>
              <div class="form-group">
                <label data-i18n="deposit">Deposit (¥)</label>
                <input type="number" id="rent-deposit" min="0" step="0.01" data-i18n-placeholder="placeholder_optional" placeholder="Optional">
              </div>
            </div>
            <div class="form-row form-row-2">
              <div class="form-group">
                <label data-i18n="start_date_required">Start date *</label>
                <input type="date" id="rent-start_date" required>
              </div>
              <div class="form-group">
                <label data-i18n="expected_end_date">Expected end date</label>
                <input type="date" id="rent-expected_end_date" data-i18n-placeholder="placeholder_optional" placeholder="Optional">
              </div>
            </div>
            <div class="form-group">
              <a href="#" id="rent-toggle-exact-location" class="link-secondary" data-i18n="add_exact_location_where">+ Add exact location — where item will go (optional)</a>
              <div id="rent-exact-location-wrap" class="hidden" style="margin-top:0.35rem;">
                <label data-i18n="exact_location">Exact location</label>
                <input type="text" id="rent-exact_location" data-i18n-placeholder="placeholder_delivery" placeholder="e.g. address or delivery spot">
              </div>
            </div>
            <div class="form-group">
              <label data-i18n="notes">Notes</label>
              <textarea id="rent-notes" rows="2"></textarea>
            </div>
            <button type="submit" class="btn btn-primary" data-i18n="confirm_rent_btn">Confirm & start rental</button>
          </form>
        </div>
        <div class="card mt-1">
          <h4 data-i18n="end_rental">End rental</h4>
          <div id="active-rentals" class="loading" data-i18n="loading">Loading…</div>
        </div>
      </div>
    </section>
  </main>
  <div id="end-rental-modal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h3 data-i18n="end_rental">End rental</h3>
        <button type="button" class="modal-close" id="end-rental-close">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="end-rental-id">
        <div class="form-group">
          <label data-i18n="end_date_required">End date *</label>
          <input type="date" id="end-rental-date" required>
        </div>
        <div class="form-group">
          <label data-i18n="item_status_after">Item status after return</label>
          <select id="end-rental-item-status">
            <option value="in_stock" data-i18n="status_in_stock">in_stock</option>
            <option value="listed" data-i18n="status_listed">listed</option>
          </select>
        </div>
        <div class="form-group">
          <label data-i18n="damage_fee">Damage fee (¥)</label>
          <input type="number" id="end-rental-damage" min="0" step="0.01" data-i18n-placeholder="placeholder_optional" placeholder="Optional">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="end-rental-cancel" data-i18n="cancel">Cancel</button>
        <button type="button" class="btn btn-primary" id="end-rental-confirm" data-i18n="end_rental_confirm">End rental</button>
      </div>
    </div>
  </div>
  <div id="toast-container" class="toast-container"></div>
  <script src="js/header.js"></script>
  <script src="js/api.js"></script>
  <script src="js/i18n.js"></script>
  <script>document.querySelectorAll('.lang-switch').forEach(function(a){ a.addEventListener('click', function(e){ e.preventDefault(); setRoomiLang(this.dataset.lang); }); }); applyI18n();</script>
  <script src="js/buy.js"></script>
  <script src="js/output.js"></script>
  <script>
    (function () {
      var main = document.getElementById('stock-main');
      var cards = document.querySelectorAll('.stock-mode-card');
      if (!main || !cards.length) return;
      function setMode(mode) {
        main.setAttribute('data-mode', mode);
        cards.forEach(function (btn) {
          var isActive = btn.getAttribute('data-mode') === mode;
          btn.classList.toggle('active', isActive);
          btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
        });
      }
      cards.forEach(function (btn) {
        btn.addEventListener('click', function () {
          setMode(this.getAttribute('data-mode'));
        });
      });
    })();
  </script>
</body>
</html>
